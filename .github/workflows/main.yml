name: VNC via Loophole Tunnel (No Token)

on:
  workflow_dispatch:

jobs:
  vnc:
    runs-on: ubuntu-latest

    steps:
    - name: Install XFCE + VNC
      run: |
        sudo apt update
        sudo apt install -y xfce4 xfce4-goodies tightvncserver

    - name: Set up VNC password
      run: |
        mkdir -p ~/.vnc
        echo "123456" | vncpasswd -f > ~/.vnc/passwd
        chmod 600 ~/.vnc/passwd

    - name: Start VNC server
      run: vncserver :1

    - name: Install Loophole
      run: |
        curl -s https://loophole.cloud/install | bash
        sudo mv loophole /usr/local/bin/

    - name: Start Loophole TCP Tunnel
      run: |
        nohup loophole tcp 5901 > loophole.log 2>&1 &

    - name: Wait and show Tunnel URL
      run: |
        sleep 10
        echo "===== LOOPHOLE TUNNEL LOG ====="
        cat loophole.log | grep "Forwarding TCP" || true
        echo "================================"

    - name: Keep alive
      run: sleep 3600
