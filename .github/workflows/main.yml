name: VNC via Remote Tunnel

on:
  workflow_dispatch:

jobs:
  start-vnc:
    runs-on: ubuntu-latest

    steps:
    - name: Install XFCE & VNC server
      run: |
        sudo apt update
        sudo apt install -y xfce4 xfce4-goodies tightvncserver wget git

    - name: Set up VNC password
      run: |
        mkdir -p ~/.vnc
        echo "123456" | vncpasswd -f > ~/.vnc/passwd
        chmod 600 ~/.vnc/passwd

    - name: Start virtual display (Xvfb)
      run: |
        export DISPLAY=:1
        vncserver :1

    - name: Install Remote Tunnel
      run: |
        curl -s https://raw.githubusercontent.com/junegunn/remote-tunnel/main/install.sh | bash

    - name: Start Remote Tunnel to expose VNC (port 5901)
      run: |
        ./rtunnel 5901 > tunnel.txt &
        sleep 10
        echo "TUNNEL LINK:"
        cat tunnel.txt | grep 'Forwarding'

    - name: Keep the session alive
      run: sleep 3600
